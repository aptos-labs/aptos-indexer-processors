name: "Nightly Run Integration Tests"

on:
  workflow_dispatch:
  schedule:
    - cron: '0 9 * * *'  # This runs the workflow every day at 9:00 AM UTC

jobs:

  nightly-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install deps and run linter
        run: |
          sudo apt update && sudo apt install libdw-dev
          cargo install cargo-sort
          rustup update
          rustup toolchain install nightly
          rustup component add clippy --toolchain nightly
          rustup component add rustfmt --toolchain nightly
          scripts/rust_lint.sh --check
        working-directory: rust

      - name: Run Integration Tests
        run: cargo test --manifest-path integration-tests/Cargo.toml
        working-directory: rust
